<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="shortcut icon" href="/images/blog/favicon.svg"><meta name="keywords" content=""><meta name="description" content=""><link rel="stylesheet" href="/styles/main.css"><link rel="stylesheet" href="/styles/post.css"><title>Surface Book 2 安装 Debian 12.5 - Daydream</title><meta name="generator" content="Hexo 7.3.0"></head><body><header><nav><ul><li><a href="/">Home</a></li><li><a href="/posts/"><span>Posts</span></a></li><li><a href="/categories/"><span>Categories</span></a></li><li><a href="/about"><span>About</span></a></li></ul></nav></header><main><header><h1>Surface Book 2 安装 Debian 12.5</h1><div><time>2024-07-01</time><div class="post-categories"><span class="category-tree"><span class="category-separator">/</span> <a href="/categories/mess/">mess</a></span></div><div class="post-tags"><span class="tag"><span class="category-separator">#</span> <a href="/tags/debug/">debug</a></span></div></div></header><h2 id="环境和工具"><a href="#环境和工具" class="headerlink" title="环境和工具"></a>环境和工具</h2><ul><li>surface book 2 13.5 16g gtx1050m</li><li>Debian 12.5 <a target="_blank" rel="noopener" href="https://www.debian.org/distrib/">完整镜像</a></li><li>启动盘制作工具：<a target="_blank" rel="noopener" href="https://rufus.ie/zh/">rufus</a></li><li>UEFI命令行工具：<a target="_blank" rel="noopener" href="https://github.com/pbatard/UEFI-Shell">UEFI-Shell</a></li><li><a target="_blank" rel="noopener" href="https://github.com/linux-surface/linux-surface">Surface Kernel 6.9.3-2</a></li></ul><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>之前尚未安装过任何linux发行版本，Debian镜像用<code>rufus</code>写入U盘后就可以开始安装了。surface book 2 按住音量上，开机，出现微软logo再松开音量键就能进入uefi，安全启动不用关闭，新版本的Debian和Ubuntu都能正确识别。<br>注意，就算是完整的Debian镜像，也需要配置网络来安装桌面环境。虽然可以配置国内的镜像地址，最好也准备个http代理来加速下载。</p><h3 id="mok清理"><a href="#mok清理" class="headerlink" title="mok清理"></a>mok清理</h3><p>如果之前安装过其他的linux发行版本，且自己签名了驱动或者内核，那就需要清理uefi的mok环境变量，不然会一直卡微软logo。该变量不是写在硬盘上，格式化硬盘是没用的。<br>使用上面的<code>UEFI-SHELL</code>制作U盘启动镜像并启动，成功进入shell环境，执行<code>dmpstore</code>可以看到所有的uefi变量，其中有一些<code>MokAuth</code>类似的变量，可以使用<code>dmpstore -d -all MokAuth</code>执行删除。但是有些mok变量可能看不到，所以可以直接使用<code>dmpstore -d -all</code>来删除所有变量，不用担心删除一些关键的变量，那些都是有写保护的。<br>mok变量清理之后就可以正常的进行系统安装。</p><h3 id="Surface-Kernel"><a href="#Surface-Kernel" class="headerlink" title="Surface Kernel"></a>Surface Kernel</h3><p>安装完成，Debian默认的用户是没有加入sudo组的，需要切换到root手动添加进去：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">su -<br>usermod -aG <span class="hljs-built_in">sudo</span> 需要添加到<span class="hljs-built_in">sudo</span>的用户名<br></code></pre></td></tr></table></figure><p>Debian 12.5默认的6.1内核是能够成功的识别部分硬件的，如键盘、触摸板等。但是一些如摄像头，触摸屏等硬件是没法识别的，所以需要安装<code>surface kernel</code>来识别其他硬件，该内核支持的surface book 2硬件可以在<a target="_blank" rel="noopener" href="https://github.com/linux-surface/linux-surface/wiki/Surface-Book-2">这里</a>查阅。<br>通过该<a target="_blank" rel="noopener" href="https://github.com/linux-surface/linux-surface/wiki/Installation-and-Setup">安装指引</a>可以成功安装内核。</p><blockquote><p>在安装<code>linux-surface-secureboot-mok</code>后重启可能没法看到mok manger，导致卡在logo。可以在<a target="_blank" rel="noopener" href="https://github.com/linux-surface/linux-surface/issues/1377">#1377</a>查看相关讨论。<br>此时关闭uefi安全启动，下载<a target="_blank" rel="noopener" href="https://www.linuxmint.com/edition.php?id=305">Linux Mint 21.2</a>制作启动U盘并启动，此时可以正确的看到mok manager的界面，enroll完成之后即可正常进入Debian系统，完成SurfaceKernel的安装。</p></blockquote><p>此时大部分的硬件都已经被系统识别出来，除了显卡驱动。</p><blockquote><p>可以安装一些工具，如<code>surface-control</code>来查看设备状态</p></blockquote><h3 id="Nvidia-Driver"><a href="#Nvidia-Driver" class="headerlink" title="Nvidia Driver"></a>Nvidia Driver</h3><p>安装<code>inxi</code>后执行<code>inxi -G</code>可以看到显卡驱动是没有安装的。按照Debian<a target="_blank" rel="noopener" href="https://wiki.debian.org/NvidiaGraphicsDrivers">官方指引</a>可以安装显卡驱动。目前环境下dkms在编译驱动时候会出现libssl报错，需要安装<code>libssl1.1</code>，在<code>/etc/apt/sources.list</code>添加旧版本debian仓库：</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">deb http<span class="hljs-punctuation">:</span><span class="hljs-comment">//deb.debian.org/debian bullseye main contrib non-free</span><br></code></pre></td></tr></table></figure><p>之后dkms可以正确签名并安装显卡驱动。<br>显卡驱动建议从官方仓库进行安装，否则需要自己<a target="_blank" rel="noopener" href="https://wiki.debian.org/SecureBoot#MOK_-_Machine_Owner_Key">签名</a>。<br>dkms自动生成的签名位于<code>/var/lib/dkms</code>，需要将其导入mok：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">mokutil --<span class="hljs-keyword">import</span> <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/dkms/m</span>ok.pub<br></code></pre></td></tr></table></figure><p>重启然后执行mok enroll，同样也需要使用linux mint的启动盘来进入mok manager。</p><p>完成之后进入系统执行<code>inxi -G</code>可以看到显卡驱动已经正确安装。但是此时触摸板的多指手势失效，因为默认显卡驱动安装好之后就会切换到<code>X11</code>，<code>X11</code>默认是不支持触摸板的多指手势的，可以在<a target="_blank" rel="noopener" href="https://docs.redhat.com/zh_hans/documentation/red_hat_enterprise_linux/8/html/using_the_desktop_environment_in_rhel_8/wayland-differences-xorg_overview-of-gnome-environments">这里</a>查看两者的差异。虽然可以使用各种第三方的手势，但是都不如<code>Wayland</code>默认的用着舒服。</p><blockquote><p>在Nvidia上启用Wayland</p></blockquote><p>按照Debian<a target="_blank" rel="noopener" href="https://wiki.debian.org/NvidiaGraphicsDrivers#Wayland">文档</a>中的方式进行操作，但是依旧无法开启<code>Wayland</code>。在<a target="_blank" rel="noopener" href="https://bbs.archlinuxcn.org/viewtopic.php?id=13796">这里</a>找到了解决方案：</p><ul><li><code>/usr/lib/udev/rules.d/61-gdm.rules</code>中配置了<code>Wayland</code>启用的各种条件；</li><li><code>sudo cp /usr/lib/udev/rules.d/61-gdm.rules /etc/udev/rules.d/61-gdm.rules</code>将该配置文件复制出来编辑，不要直接修改；</li></ul><p>默认上面Debian的文档满足了大部分启用条件，但是在<code>/usr/lib/udev/rules.d/61-gdm.rules</code>87行左右有如下是否是双显卡笔记本检测，有则禁用<code>Wayland</code>：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># If this is a hybrid graphics laptop with vendor nvidia driver, disable wayland</span><br><span class="hljs-attribute">LABEL</span>=<span class="hljs-string">&quot;gdm_hybrid_nvidia_laptop_check&quot;</span><br>TEST!=<span class="hljs-string">&quot;/run/udev/gdm-machine-is-laptop&quot;</span>, <span class="hljs-attribute">GOTO</span>=<span class="hljs-string">&quot;gdm_hybrid_nvidia_laptop_check_end&quot;</span><br>TEST!=<span class="hljs-string">&quot;/run/udev/gdm-machine-has-hybrid-graphics&quot;</span>, <span class="hljs-attribute">GOTO</span>=<span class="hljs-string">&quot;gdm_hybrid_nvidia_laptop_check_end&quot;</span><br>TEST!=<span class="hljs-string">&quot;/run/udev/gdm-machine-has-vendor-nvidia-driver&quot;</span>, <span class="hljs-attribute">GOTO</span>=<span class="hljs-string">&quot;gdm_hybrid_nvidia_laptop_check_end&quot;</span><br><span class="hljs-attribute">GOTO</span>=<span class="hljs-string">&quot;gdm_disable_wayland&quot;</span><br><span class="hljs-attribute">LABEL</span>=<span class="hljs-string">&quot;gdm_hybrid_nvidia_laptop_check_end&quot;</span><br></code></pre></td></tr></table></figure><p>此处在复制出来的配置中注释即可，重启即可成功启用<code>Wayland</code>。</p><h3 id="摄像头"><a href="#摄像头" class="headerlink" title="摄像头"></a>摄像头</h3><p>surface kernel目前是不支持摄像头的，需要手动编译<a target="_blank" rel="noopener" href="https://github.com/linux-surface/linux-surface/wiki/Camera-Support">libcamera</a>来支持。</p><h3 id="休眠"><a href="#休眠" class="headerlink" title="休眠"></a>休眠</h3><p>遇到休眠被莫名的唤醒事件打断，可以在<a target="_blank" rel="noopener" href="https://github.com/linux-surface/linux-surface/issues/1412">这里</a>看到讨论。</p><p>主动触发休眠是会被Debian系统设置中<code>Power-Automatic Suspend-On</code>打断的，所以如果要通过<code>sudo systemctl hibernate</code>验证休眠功能是否正常，需要关闭前面的设置。</p><p>使用swap分区需要配置<code>/etc/fstab</code>为：<code>LABEL=swap none swap sw 0 0</code>，分区没有指定<code>label</code>时使用<code>UUID</code>，分区信息使用<code>blkid</code>查看。<br>同时需要修改<code>/etc/initramfs-tools/conf.d/resume</code>，和上面一样需要指定<code>label</code>或者<code>uuid</code>，然后<code>update-initramfs -u</code>刷新配置。</p><h3 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h3><p>偶尔开机会出现<code>dev-surface-dtx.service</code>启动失败，导致键盘、触摸板全部失效，可以在<a target="_blank" rel="noopener" href="https://github.com/linux-surface/linux-surface/issues/1420">这里</a>找到相关讨论，临时禁用dtx服务就行（重启也能解决）：</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss">systemctl <span class="hljs-keyword">disable</span> <span class="hljs-built_in">surface</span>-dtx-daemon.service<br></code></pre></td></tr></table></figure><h2 id="其他设置"><a href="#其他设置" class="headerlink" title="其他设置"></a>其他设置</h2><p><strong>可以使用<code>localectl</code>来设置系统区域选项</strong></p><p><strong>将默认的grub启动菜单换成黑白控制台，在<code>/etc/default/grub</code>添加<code>GRUB_BACKGROUND=&quot;&quot;</code>将背景置空，创建<code>/boot/grub/custom.cfg</code>添加以下内容，然后<code>update-grub</code>重启即可看到效果。</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">set</span> <span class="hljs-attribute">menu_color_normal</span>=white/black<br><span class="hljs-built_in">set</span> <span class="hljs-attribute">menu_color_highlight</span>=black/light-gray<br></code></pre></td></tr></table></figure><p><strong>插件：</strong></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-comment"># 托盘图标</span><br>sudo apt install gnome-<span class="hljs-built_in">shell</span>-<span class="hljs-built_in">extension</span>-appindicator<br><span class="hljs-comment"># 桌面任务栏</span><br>sudo apt install gnome-<span class="hljs-built_in">shell</span>-<span class="hljs-built_in">extension</span>-dashtodock<br><span class="hljs-comment"># 系统资源监控</span><br>sudo apt install gnome-<span class="hljs-built_in">shell</span>-<span class="hljs-built_in">extension</span>-<span class="hljs-keyword">system</span>-monitor<br></code></pre></td></tr></table></figure><blockquote class="copyright"><p>本站所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</p></blockquote></main><nav class="pagination"><span class="prev"><a href="/posts/chengdu-telecom-iptv-udpxy-config">华硕路由器实现iptv组播转单播和单线复用 </a></span><span class="next"><a href="/posts/qemu-docker-dsm-boot">qemu-docker 引导黑群晖</a></span></nav><script src="/js/main.js"></script><footer><p class="socials"><a href="https://github.com/lostars" target="_blank"><svg class="fontawesome-icon"><use href="/icons/fontawesome.svg#github"></use></svg> </a><a href="https://open.spotify.com/user/boyizmen" target="_blank"><svg class="fontawesome-icon"><use href="/icons/fontawesome.svg#spotify"></use></svg> </a><a href="https://space.bilibili.com/20516992" target="_blank"><svg class="fontawesome-icon"><use href="/icons/fontawesome.svg#bilibili"></use></svg> </a><input type="hidden" id="emailUser" value="bW9tbw=="> <input type="hidden" id="emailDomain" value="bWluZWkubWU="> <a id="emailLink" href="#" target="_blank"><svg class="fontawesome-icon"><use href="/icons/fontawesome.svg#email"></use></svg></a></p><p>Build with ❤ I abandon here my love</p><p>Copyright &copy; 2025 boyizmen</p></footer></body></html>
<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="shortcut icon" href="/images/blog/favicon.svg"><meta name="keywords" content=""><meta name="description" content=""><link rel="stylesheet" href="/styles/main.css"><link rel="stylesheet" href="/styles/post.css"><title>JAVA 10 新特性 - 局部变量推断 - Daydream</title><meta name="generator" content="Hexo 7.3.0"></head><body><header><nav><ul><li><a href="/">Home</a></li><li><a href="/posts/"><span>Posts</span></a></li><li><a href="/categories/"><span>Categories</span></a></li><li><a href="/about"><span>About</span></a></li></ul></nav></header><main><header><h1>JAVA 10 新特性 - 局部变量推断</h1><div><time>2020-04-14</time><div class="post-categories"><span class="category-tree"><span class="category-separator">/</span> <a href="/categories/dev/">dev</a></span></div><div class="post-tags"><span class="tag"><span class="category-separator">#</span> <a href="/tags/java/">java</a> </span><span class="tag"><span class="category-separator">#</span> <a href="/tags/jdk10/">jdk10</a></span></div></div></header><p>Java 10 添加了一个非常重要的新特性：局部变量类型推断。</p><p>在声明局部变量的时候使用下面的方式：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">var</span> <span class="hljs-variable">intValue</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><span class="hljs-type">var</span> <span class="hljs-variable">doubleValue</span> <span class="hljs-operator">=</span> <span class="hljs-number">1.1</span>;<br><span class="hljs-type">var</span> <span class="hljs-variable">stringValue</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;string&quot;</span>;<br><span class="hljs-type">var</span> <span class="hljs-variable">list</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><span class="hljs-type">var</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br></code></pre></td></tr></table></figure><p>局部变量推断使用的是 <code>var</code> ，同时 <code>var</code> 并不是一个关键词，而是一个保留类型名，所有使用var进行命名的方法、属性、变量都不会受到任何影响；但是使用var命名的类名和接口会受到影响，如果是新建类或者接口使用var则会编译不通过。后者其实可以忽略，因为类名和接口命名都是遵循的驼峰，刚好规避了var这个单词。</p><p>就从编码上来说，代码上会简洁不少，少了挺多的冗余代码。但是有好处就有坏处，代码的可读性比以前低，无法直观的看到变量类型，如果存在大量局部变量的调用和声明代码读起来可能就不太舒服了。不过个人觉得是提升了不少效率，再也不用显示声明变量类型了。</p><p>变量推断可以使用的场景：</p><ul><li>局部变量的初始化，不能使用 var 进行不初始化的声明；<br>比如：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">var</span> a;<br></code></pre></td></tr></table></figure></li><li>for循环（包括for-each）迭代中的索引和迭代元素引用（其实也算是局部变量）；</li></ul><p>同时需要注意下面几点：</p><ul><li>无法从null值中推断，也就是说如果声明的地方有隐式的null值会抛出空指针；<br>比如：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loop</span><span class="hljs-params">(List&lt;Integer&gt; ints)</span> &#123;<br>      <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i : ints) &#123;<br>          <span class="hljs-comment">// ...do something</span><br>      &#125;<br>  &#125;<br>  <span class="hljs-comment">// 调用会直接抛出空指针</span><br>  loop(Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>))<br></code></pre></td></tr></table></figure></li><li>无法使用在方法中、构造器、返回值、属性声明、异常处理和其他变量初始化场景，可以直接直接理解成只能使用在局部变量上；<br>比如下面的代码：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> <span class="hljs-title function_">test</span><span class="hljs-params">(<span class="hljs-keyword">var</span> p1, <span class="hljs-keyword">var</span> p2)</span> &#123;...&#125;<br></code></pre></td></tr></table></figure></li><li>无法推断未初始化的变量；</li></ul><p>看下上面代码的class文件反编译后的代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">intValue</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br><span class="hljs-type">double</span> <span class="hljs-variable">doubleValue</span> <span class="hljs-operator">=</span> <span class="hljs-number">1.1D</span>;<br><span class="hljs-type">String</span> <span class="hljs-variable">stringValue</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;string&quot;</span>;<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br></code></pre></td></tr></table></figure><p>编译完后的class中其实已经是正确的类型了，可以知道类型推断是发生在编译期的，在编译期间，编译器会执行推断进行类型转换，如果变量为null则会抛出空指针异常。<br>可以看到其实局部变量推断是一种新的语法糖，jvm是不认识这个东西的，整个推断过程都是发生在编译期，jvm不需要任何的改动来支持这个特性。</p><p>参考文档：<br><a target="_blank" rel="noopener" href="https://openjdk.java.net/jeps/286">https://openjdk.java.net/jeps/286</a></p><hr><p>整个Java10的新特性看了一遍，也就这个是个比较大的改动，并且是直接对编码上有着不少的效率提升。</p><blockquote class="copyright"><p>本站所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</p></blockquote></main><nav class="pagination"><span class="prev"><a href="/posts/541">JAVA 14 新特性 - switch表达式 </a></span><span class="next"><a href="/posts/bye-2019">拥抱2020</a></span></nav><script src="/js/main.js"></script><footer><p class="socials"><a href="https://github.com/lostars" target="_blank"><svg class="fontawesome-icon"><use href="/icons/fontawesome.svg#github"></use></svg> </a><a href="https://open.spotify.com/user/boyizmen" target="_blank"><svg class="fontawesome-icon"><use href="/icons/fontawesome.svg#spotify"></use></svg> </a><a href="https://space.bilibili.com/20516992" target="_blank"><svg class="fontawesome-icon"><use href="/icons/fontawesome.svg#bilibili"></use></svg> </a><input type="hidden" id="emailUser" value="bW9tbw=="> <input type="hidden" id="emailDomain" value="bWluZWkubWU="> <a id="emailLink" href="#" target="_blank"><svg class="fontawesome-icon"><use href="/icons/fontawesome.svg#email"></use></svg></a></p><p>Build with ❤ I abandon here my love</p><p>Copyright &copy; 2025 boyizmen</p></footer></body></html>
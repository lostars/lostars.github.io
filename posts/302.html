<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="shortcut icon" href="/images/blog/favicon.svg"><meta name="keywords" content=""><meta name="description" content=""><link rel="stylesheet" href="/styles/main.css"><link rel="stylesheet" href="/styles/post.css"><title>JAVA 9 新特性 — HTTP2 - Daydream</title><meta name="generator" content="Hexo 7.3.0"></head><body><header><nav><ul><li><a href="/">Home</a></li><li><a href="/posts/"><span>Posts</span></a></li><li><a href="/categories/"><span>Categories</span></a></li><li><a href="/about"><span>About</span></a></li></ul></nav></header><main><header><h1>JAVA 9 新特性 — HTTP2</h1><div><time>2018-01-08</time><div class="post-categories"><span class="category-tree"><span class="category-separator">/</span> <a href="/categories/dev/">dev</a></span></div><div class="post-tags"><span class="tag"><span class="category-separator">#</span> <a href="/tags/java/">java</a> </span><span class="tag"><span class="category-separator">#</span> <a href="/tags/jdk9/">jdk9</a></span></div></div></header><p>Java 9中正式加入了对HTTP2的支持，同时对http client包进行了模块化封装，不过并没有正式加入java api，暂时放入一个临时的模块中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">requires</span> jdk.incubator.httpclient;<br></code></pre></td></tr></table></figure><p>所以在调用的时候会有警告：WARNING: Using incubator modules: jdk.incubator.httpclient.<br>在下一个java 版本中会正式加入，并且移除旧模块。</p><p>新的api调用方式十分简单，首先需要一个HttpClient，实例化方式是通过builder来实例化:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">HttpClient.<span class="hljs-type">Builder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> HttpClient.newBuilder()<br></code></pre></td></tr></table></figure><p>然后是HttpRequest的实例化：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">HttpRequest.<span class="hljs-type">Builder</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> HttpRequest.newBuilder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">URI</span>(<span class="hljs-string">&quot;https://www.baidu.com&quot;</span>));<br></code></pre></td></tr></table></figure><p>同样也是builder模式.请求发送：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">client.send(request, HttpResponse.BodyHandler.asString(Charset.forName(<span class="hljs-string">&quot;utf-8&quot;</span>))<br></code></pre></td></tr></table></figure><p>请求返回都是返回一个HttpResponse，里面包含了常用对相应的不同处理方式。下面简单介绍一下：</p><ul><li>asString 将返回数据处理成字符串。</li><li>asFile 可以将相应body保存为文件。</li><li>asFileDownload 作为文件下载；这个从源码可以看到响应头必须包含Content-Disposition和attachment。</li><li>asByteArray 作为字节数组；这个可以将相应保存为文件等等。</li><li>apply 可以根据响应状态码来返回一个BodyProcessor，自定义处理。</li><li>discard 忽略响应体，用自定义内容代替。</li></ul><p>BodyHandler和BodyProcessor里都定义了对不同响应body的处理实现，对于一个基本的http client来说已经足够。来看下HttpClient.Builder的一些常用方法：</p><ul><li>followRedirects 重定向设置，默认不允许重定向；<br>NEVER 从不<br>ALWAYS 总是<br>SAME_PROTOCOL 允许相同协议重定向<br>SECURE 允许安全协议重定向，不允许从https到http</li><li>proxy 代理;<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">builder.proxy(ProxySelector.of(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InetSocketAddress</span>(Inet4Address.getByName(<span class="hljs-string">&quot;127.0.0.1&quot;</span>), <span class="hljs-number">1080</span>)));<br></code></pre></td></tr></table></figure></li><li>authenticator http验证；<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">builder.authenticator(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Authenticator</span>() &#123;<br>       <span class="hljs-meta">@Override</span><br>       <span class="hljs-keyword">protected</span> PasswordAuthentication <span class="hljs-title function_">getPasswordAuthentication</span><span class="hljs-params">()</span> &#123;<br>           <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PasswordAuthentication</span>(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;password&quot;</span>.toCharArray());<br>       &#125;<br>   &#125;);<br></code></pre></td></tr></table></figure></li><li>priority HTTP2请求优先级 0-256，越大优先级越高；</li><li>executor 异步任务，请求同时也可以调用异步任务。由于传入的是Executor接口，支持的实现就比较多了，可以是ExecutorService创建的单线程或多线程任务，也可以是定时任务等等；</li><li>cookieManager 请求cookie的设置，可设置不接受cookie等等；</li></ul><p>同时HttpClient和HttpRequest中都可以对http 版本进行设置，默认是HTTP2，且后者会覆盖前者的设置，如果HTTP2的响应并不是对应版本则会回退到HTTP1.1</p><p>可以看到新的http client api对常用http请求已经做了比较好的封装和修改，基本使用已经可以抛弃apache的http client工具了。</p><p>在Java 9中，还对websocket进行了支持，可以查看<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/9/docs/api/jdk/incubator/http/WebSocket.html%E4%BA%86%E8%A7%A3%E3%80%82">https://docs.oracle.com/javase/9/docs/api/jdk/incubator/http/WebSocket.html了解。</a></p><p>参考文档：<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/9/docs/api/jdk/incubator/http/package-summary.html">https://docs.oracle.com/javase/9/docs/api/jdk/incubator/http/package-summary.html</a></p><blockquote class="copyright"><p>本站所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</p></blockquote></main><nav class="pagination"><span class="prev"><a href="/posts/303">EFFECTIVE JAVA 3RD EDITION — 第二章 创建和销毁对象 </a></span><span class="next"><a href="/posts/300">JAVA 9 新特性 — MODULE SYSTEM 之 SERVICE</a></span></nav><script src="/js/main.js"></script><footer><p class="socials"><a href="https://github.com/lostars" target="_blank"><svg class="fontawesome-icon"><use href="/icons/fontawesome.svg#github"></use></svg> </a><a href="https://open.spotify.com/user/boyizmen" target="_blank"><svg class="fontawesome-icon"><use href="/icons/fontawesome.svg#spotify"></use></svg> </a><a href="https://space.bilibili.com/20516992" target="_blank"><svg class="fontawesome-icon"><use href="/icons/fontawesome.svg#bilibili"></use></svg> </a><input type="hidden" id="emailUser" value="bW9tbw=="> <input type="hidden" id="emailDomain" value="bWluZWkubWU="> <a id="emailLink" href="#" target="_blank"><svg class="fontawesome-icon"><use href="/icons/fontawesome.svg#email"></use></svg></a></p><p>Build with ❤ I abandon here my love</p><p>Copyright &copy; 2025 boyizmen</p></footer></body></html>
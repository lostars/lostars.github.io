<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="shortcut icon" href="/images/blog/favicon.svg"><meta name="keywords" content=""><meta name="description" content=""><link rel="stylesheet" href="/styles/main.css"><link rel="stylesheet" href="/styles/post.css"><title>MYSQL REPLACE踩坑 - Daydream</title><meta name="generator" content="Hexo 7.3.0"></head><body><header><nav><ul><li><a href="/">Home</a></li><li><a href="/posts/"><span>Posts</span></a></li><li><a href="/categories/"><span>Categories</span></a></li><li><a href="/about"><span>About</span></a></li></ul></nav></header><main><header><h1>MYSQL REPLACE踩坑</h1><div><time>2017-09-07</time><div class="post-categories"><span class="category-tree"><span class="category-separator">/</span> <a href="/categories/dev/">dev</a></span></div><div class="post-tags"><span class="tag"><span class="category-separator">#</span> <a href="/tags/mysql/">mysql</a></span></div></div></header><p>Mysql replace关键字类似于insert关键字，不过replace首先会尝试插入一条新的数据，如果抛出异常（检查表的主键和唯一索引）则会删除该条数据，然后再次插入数据，这就是为什么sql执行后会返回2 rows受影响。</p><p>如果表的主键和唯一索引同时存在，则会导致主键增长过快，且如果replace的数据存在，如果replace字段没有覆盖所有字段会导致删除数据、新增的时候数据丢失（甚至报错，如果丢失字段非空但又没有默认值的时候）。</p><p>之前为了偷懒想着新增修改一条sql就用了replace，但是发现修改数据的时候发现数据丢失，真的是得不偿失。公司项目当时用replace的场景是消息盒子里不同类消息显示最新一条消息，有一张辅助的表来存储最新的消息，这张表没有主键，一个唯一索引，且数据量较大。</p><p>细想是没有仔细理解replace导致滥用，现在更深入的了解了之后发现replace慎用，慎用啊！！！</p><blockquote class="copyright"><p>本站所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</p></blockquote></main><nav class="pagination"><span class="prev"><a href="/posts/297">JAVA 9 新特性 — MODULE SYSTEM </a></span><span class="next"></span></nav><script src="/js/main.js"></script><footer><p class="socials"><a href="https://github.com/lostars" target="_blank"><svg class="fontawesome-icon"><use href="/icons/fontawesome.svg#github"></use></svg> </a><a href="https://open.spotify.com/user/boyizmen" target="_blank"><svg class="fontawesome-icon"><use href="/icons/fontawesome.svg#spotify"></use></svg> </a><a href="https://space.bilibili.com/20516992" target="_blank"><svg class="fontawesome-icon"><use href="/icons/fontawesome.svg#bilibili"></use></svg> </a><input type="hidden" id="emailUser" value="bW9tbw=="> <input type="hidden" id="emailDomain" value="bWluZWkubWU="> <a id="emailLink" href="#" target="_blank"><svg class="fontawesome-icon"><use href="/icons/fontawesome.svg#email"></use></svg></a></p><p>Build with ❤ I abandon here my love</p><p>Copyright &copy; 2025 boyizmen</p></footer></body></html>